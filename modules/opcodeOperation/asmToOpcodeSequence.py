import os

def asmToOpcode(filename,opcodeList):

	# start function variables
	(file, ext) 	= os.path.splitext(filename)
	outputFileName 	=	file+".opcode" 
	outfile 		= open(outputFileName, 'w')
	
	# Read the code from the file
	try:
		content = open(filename,"r").read()
		parsdContent = content.split("\n")
		
		for item in parsdContent:
			item = ' '.join(item.split())
			opcContent = item.split(" ")
			# print opcContent
			for opcode in opcodeList:
				if opcode in opcContent :
					if not ((opcode in ["in","and","or"]) and (("file" in opcContent) or ("File"  in opcContent) or ("size" in opcContent) or ("Section" in opcContent))):
						outfile.write(opcode+",")
						#print opcContent
						break
					

	except Exception as err:
		print str(err)

	print outputFileName+" opcode list dumped."
	
	
def asmToOpcodeFolder(directory,extensionList):
	
	opcodes = []
	opcodeList = open("opcodelist.txt", 'rb').readlines()
	
	for i in range(len(opcodeList)):
		opcodes.append(opcodeList[i].strip('\n'))
	

	for root, dirs, files in os.walk(directory):
		for file in files:
			(filename, ext)	= os.path.splitext(file)
			if ext in extensionList:
				filename = root+"\\"+file
				asmToOpcode(filename,opcodes)

def uniqueOpcodes(folderPath, extensionList):
	outputFileName 	= folderPath+"unique.opcode" 
	outfile 		= open(outputFileName, 'w')
	opcodeList			= []
	
	for root, dirs, files in os.walk(folderPath):
		for file in files:
			(filename, ext)	= os.path.splitext(file)
			if ext in extensionList:
				filename = root+"\\"+file
				content  = open(filename,"r").read()
				oplist   = content.split(",")
				
				for opcode in oplist:
					if (opcode not in opcodeList) and (opcode not in " "):
						opcodeList.append(opcode)
						outfile.write(opcode+",")
				

#asmToOpcodeFolder('C:\\Users\\asus\\Desktop\\workspace\\ASM\\',[".asm",".ASM"])
uniqueOpcodes('C:\\Users\\asus\\Desktop\\workspace\\ASM\\',[".opcode"])